# Outils SNMP
## snmpstatus
Tente d'Ã©tablir une connexion avec un agent sur le port UDP:161 de l'hÃ´te spÃ©cifiÃ©.
``` bash  
snmpstatus -v 2c -c public localhost
```
> ğŸ—’ï¸ Rien ne vous empÃªche de remplacer "localhost" (127.0.0.1) par l'IP ou le FQDN d'un agent SNMP distant pour peut qu'il soit correctement configurÃ©.

## snmpget
Envoie une requÃªte de type "GET" Ã  un agent SNMP pour rÃ©cupÃ©rer la valeur d'un OID.
``` bash  
snmpget -c public -v 2c localhost .1.3.6.1.2.1.1.1
```

## snmpwalk
Affiche les OID et valeurs accessibles pour l'ensemble des mibs chargÃ©es (snmp.conf).
``` bash
snmpwalk -v 2c -c public localhost
```
 ## snmptable
 Certain OID font rÃ©fÃ©rence Ã  des donnÃ©es stockÃ©es sous forme de tableau comme les interfaces rÃ©seau, les points de montage, etc. La commande snmptable est conÃ§ue pour rÃ©cupÃ©rer les diffÃ©rentes valeurs des tableaux.
``` bash  
snmptable -c public -v 2c localhost  .1.3.6.1.2.1.2.2
```
## snmptranslate
L'outil `snmptranslate` permet de convertir des IOD (arborescence numÃ©rique) en valeur symbolique (son label) mais pas que ...
### Conversion d'OID
La faÃ§on la plus simple d'utiliser `snmptranslate` est de lui fournir une OID. Vous obtiendrez comme rÃ©ponse NOM_DE_LA_MIB::valeur_symbolique_ou_label de cet OID

``` bash  
snmptranslate .1.3.6.1.2.1.1.3.0

SNMPv2-MIB::sysUpTime.0
```
> :warning: **Exercices**:  
> DÃ©terminez le nom symbolique et la MIB d'origine de ces OID.
> - .1.3.6.1.2.1.25.1.1  
> - .1.3.6.1.2.1.2.2.1.6  
> - .1.3.6.1.4.1.2021.100.4

L'opÃ©ration inverse est possible avec l'option -On. Il faut founir le nom de la MIB, les :: suivi du nom symbolique.
``` bash
snmptranslate -On SNMPv2-MIB::sysUpTime.0

.1.3.6.1.2.1.1.3.0
```
> L'option -On: -O pour 'output' et "n" pour version numÃ©rique. En gros on demande d'afficher la valeur munÃ©rique de l'IOD.

> :warning: Avant de faire cet excercice vÃ©rifiez que les mibs HOST-RESOURCES-MIB et RFC1213-MIB soient chargÃ©es:  
> **Exercices**: DÃ©terminez le OID numÃ©rique avec `snmptranslate` et rÃ©cupÃ©rez sa valeur avec `snmpget`
> - IF-MIB::ifPhysAddress.1 (adresse MAC de la 1ere interface rÃ©seau)
> - HOST-RESOURCES-MIB::hrSystemProcesses  (nombre de processus en cours d'execution sur le systÃ¨me)
> - HOST-RESOURCES-MIB::hrMemorySize (taille de la RAM)

Il existe plusieurs autres faÃ§ons d'afficher un OID, jetez un oeil au `man snmpcmd` Ã  la section OUTOUT option -Of.

### Afficher un objet dans d'une mib
Comme on l'a vu `snmptranslate` s'attend a recevoir un OID (Object Identifier) complet.
> Pour rappel, un OID est un chemin (arborescence) qui fait rÃ©fÃ©rence a une donnÃ©e dans une mib.

Si l'OID est incomplÃ¨te (chemin numÃ©rique ou symbolique incomplet) vous ne pourrez pas atteindre la donnÃ©e visÃ©e.

``` bash
snmptranslate sysUpTime.0

Invalid object identifier: sysUpTime.0
```
:x: Sans surprise  une erreur remonte l'OID fourni n'est pas un chemin, `sysUpTime.0` n'est pas reconnu comme un OID valide,

> :memo: Pour rapel: Un OID spÃ©cifie l'emplacement d'un objet dans la strucure en arborescente d'une MIB (Management Information Base). Cette structure en arborescente est organisÃ©e de maniÃ¨re Ã  ce que chaque nÅ“ud reprÃ©sente un groupe d'objets ou des objets individuels.

Malheureusement il se peut que vous possÃ©diez que le nom symbolique d'un OID, dans ce cas l'option -IR est faite pour vous.
Elle permet parcourir une MIB et de rechercher le nom de l'objet que vous avez mentionnÃ©.

``` bash
snmptranslate -IR sysUpTime.0

SNMPv2-MIB::sysUpTime.0
```
Cela signifie que vous pouvez faire rÃ©fÃ©rence a un OID sans avoir besoin du chemin complet.

Encore plus fort; si vous ne connaissez pas le nom excact de votre OID, mais qu'une partie qui pourrait contenir Ã  "sys" et "time" (pour l'heure systÃ¨me par exemple)

L'option -Ib autorise les expressions rÃ©guliÃ¨res .
``` bash
snmptranslate -Ib 'sys.*time'

SNMPv2-MIB::sysORUpTime
```
> Notez que l'option -Ib tentera (avec plus ou moins de succÃ¨s ) de renvoyer un rÃ©sultat qui semble proche de votre recherche. Cette option peut paraitre parfois un peu frustrante.

Une autre approche consiste a rÃ©cupÃ©rer tout la liste des OID (et non le rÃ©sultat le "plus probable") qui rÃ©pondent Ã  votre expression rÃ©guliÃ¨re.

``` bash
snmptranslate -TB 'sys.*time'

SNMPv2-MIB::sysORUpTime
SNMPv2-MIB::sysUpTime
HOST-RESOURCES-MIB::hrSystemUptime
```
> :warning: Vous l'avez compris, il devient vite extrÃªment complexe de gÃ©rer autant d'OID dispersÃ©s dans diffÃ©rentes mid.

Pour rÃ©soudre ce probleme: utilisez un outil graphique  "mibbrowser".  
![image](https://github.com/ornech/SNMP/assets/101867500/49ae1e6e-e8a1-44e9-91c5-1ca651a2ed73)

Il permet:
 - de charger des mib
 - visualer les OID
 - d'intÃ©roger un agent SNMP local ou distant pour peu que mibbrowser soit configurer correctement. C'est ce que vous allez faire afin de connecter depuis votre PC au conteneur Proxmox oÃ¹ votre agent SNMP est installÃ©. Rendez vous dans le menu -> Tools -> Options -> Onglet "Agents" et ajouter un agent
 - ![image](https://github.com/ornech/SNMP/assets/101867500/3352775b-6bc8-4742-a3b1-01664aa62be0)

   
Disponible sur le moodle ou en ligne (nÃ©cessite l'installation de java: https://www.oracle.com/java/technologies/downloads/)

### Autres informations
Pour afficher la description complÃ¨te (stockÃ©e dans le fichier MIB) d'un OID en particulier, utilisez l'option -Td :
``` bash
snmptranslate -Td SNMPv2-MIB::sysUpTime

SNMPv2-MIB::sysUpTime
sysUpTime OBJECT-TYPE
  -- FROM	SNMPv2-MIB
  SYNTAX	TimeTicks
  MAX-ACCESS	read-only
  STATUS	current
  DESCRIPTION	"The time (in hundredths of a second) since the
            network management portion of the system was last
            re-initialized."
::= { iso(1) org(3) dod(6) internet(1) mgmt(2) mib-2(1) system(1) 3 }
```
On peut voir que cet OID:
 - Provient de la mib SNMPv2-MIB
 - Que c'est une valeur de lecture seule
 - Qu'il s'agit du temps (en centiÃ¨mes de seconde) Ã©coulÃ© depuis la derniÃ¨re initialisation du dÃ©mon en charge de la gestion du rÃ©seau (NetworkManager ou systemd-networkd tout dÃ©pand de votre OS).

# Autres outils
**snmp-bridge-mib** : Collecte des informations sur un pont rÃ©seaux Linux et exporte ces donnÃ©es afin qu'elles 

**snmpconf** : Outil qui permet de configuration du dÃ©mon SNMP (snmpd) -> /etc/snmp/snmpd.conf.  

**snmpping** : Envoie une requÃªte de type "PING" Ã  un pÃ©riphÃ©rique SNMP capable de rÃ©pondre Ã  ces requÃªtes. Cela permet de vÃ©rifier la connectivitÃ© et la disponibilitÃ© du pÃ©riphÃ©rique.  


**snmptrap** : Envoie des notifications SNMP (traps) Ã  un gestionnaire SNMP pour informer des Ã©vÃ©nements tels que les pannes, les erreurs, etc.  
**snmpbulkget** :RÃ©cupÃ©re un grand volume de donnÃ©es SNMP en une seule requÃªte.  



